{% extends "home/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2">
            <div class="card">
                <div class="card-header" style="background-color: #000000; color: #ffffff;">
                    <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Admin Panel</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{% url 'admin_dashboard' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-home me-2"></i>Dashboard
                    </a>
                    <a href="{% url 'admin_applications' %}" class="list-group-item list-group-item-action active">
                        <i class="fas fa-briefcase me-2"></i>Job Applications
                    </a>
                    <a href="{% url 'admin_contacts' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-envelope me-2"></i>Contact Forms
                    </a>
                    <a href="{% url 'admin_replies' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-reply me-2"></i>Replies
                    </a>
                    <a href="{% url 'admin_users' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-users me-2"></i>Users
                    </a>
                    <a href="{% url 'admin_careers' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-clipboard-list me-2"></i>Job Openings
                    </a>
                    <a href="{% url 'admin_products' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-box me-2"></i>Products
                    </a>
                    <a href="{% url 'admin_settings' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-cog me-2"></i>Settings
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Job Applications</h2>
                <div>
                    <button class="btn btn-outline-primary" onclick="toggleBulkActions()">
                        <i class="fas fa-tasks me-1"></i>Bulk Actions
                    </button>
                </div>
            </div>

            <!-- Bulk Actions Form -->
            <div id="bulkActionsForm" class="card mb-4" style="display: none;">
                <div class="card-body">
                    <form method="post" action="{% url 'admin_bulk_actions' %}">
                        {% csrf_token %}
                        <input type="hidden" name="model_type" value="applications">
                        <div class="row align-items-end">
                            <div class="col-md-4">
                                <label class="form-label">Action</label>
                                <select name="action" class="form-select" required>
                                    <option value="">Select Action</option>
                                    <option value="update_status">Update Status</option>
                                    <option value="delete">Delete Selected</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">New Status (if updating)</label>
                                <select name="bulk_status" class="form-select">
                                    <option value="">Select Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="reviewed">Reviewed</option>
                                    <option value="shortlisted">Shortlisted</option>
                                    <option value="interviewed">Interviewed</option>
                                    <option value="hired">Hired</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-primary">Apply to Selected</button>
                                <button type="button" class="btn btn-secondary" onclick="toggleBulkActions()">Cancel</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Applications Table -->
            <div class="card">
                <div class="card-body">
                    {% if applications %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" id="selectAll"></th>
                                        <th>Applicant</th>
                                        <th>Position</th>
                                        <th>Experience</th>
                                        <th>Status</th>
                                        <th>Applied Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for application in applications %}
                                    <tr>
                                        <td><input type="checkbox" name="selected_items" value="{{ application.id }}" class="application-checkbox"></td>
                                        <td>
                                            <strong>{{ application.first_name }} {{ application.last_name }}</strong><br>
                                            <small class="text-muted">{{ application.email }}</small>
                                        </td>
                                        <td>{{ application.career.title }}</td>
                                        <td>{{ application.get_experience_years_display }}</td>
                                        <td>
                                            <span class="badge bg-{% if application.status == 'pending' %}warning{% elif application.status == 'hired' %}success{% elif application.status == 'rejected' %}danger{% else %}info{% endif %}">
                                                {{ application.get_status_display }}
                                            </span>
                                        </td>
                                        <td>{{ application.created_at|date:"M d, Y H:i" }}</td>
                                        <td>
                                            <a href="{% url 'admin_application_detail' application.id %}" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-eye"></i> View
                                            </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-briefcase fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">No job applications yet</h5>
                            <p class="text-muted">Applications will appear here when candidates apply for positions.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function toggleBulkActions() {
    const form = document.getElementById('bulkActionsForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}

// Select all functionality
document.getElementById('selectAll').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.application-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
});

// Add selected items to bulk form
document.querySelector('form[action="{% url 'admin_bulk_actions' %}"]').addEventListener('submit', function(e) {
    const selectedCheckboxes = document.querySelectorAll('.application-checkbox:checked');
    if (selectedCheckboxes.length === 0) {
        e.preventDefault();
        alert('Please select at least one application.');
        return;
    }
    
    // Add selected items to form
    selectedCheckboxes.forEach(checkbox => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'selected_items';
        input.value = checkbox.value;
        this.appendChild(input);
    });
});
</script>
{% endblock %}